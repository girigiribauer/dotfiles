---
- name: Dock settings (1/4)
  osx_defaults:
    domain: com.apple.dock
    key: magnification
    type: bool
    value: true
    state: present
  tags: preferences

- name: Dock settings (2/4)
  osx_defaults:
    domain: com.apple.dock
    key: largesize
    type: float
    value: 128
    state: present
  tags: preferences

- name: Dock settings (3/4)
  osx_defaults:
    domain: com.apple.dock
    key: tilesize
    type: float
    value: 32
    state: present
  tags: preferences

- name: Dock settings (4/4)
  osx_defaults:
    domain: com.apple.dock
    key: autohide
    type: bool
    value: true
    state: present
  tags: preferences

- name: FileVault settings (1/4)
  shell: fdesetup isactive
  register: filevault_status
  changed_when: False
  tags: preferences

- name: FileVault settings (2/4)
  shell: fdesetup {{ "enable" if security.filevault else "disable" }}
  when: (security.filevault is defined) and (filevault_status.stdout == "true" and security.filevault != True) or (filevault_status.stdout == "false" and security.filevault == True)
  become: True
  tags: preferences

- name: FileVault settings (3/4)
  shell: defaults read /Library/Preferences/com.apple.alf globalstate
  register: firewall_status
  changed_when: False
  tags: preferences

- name: FileVault settings (4/4)
  shell: defaults write /Library/Preferences/com.apple.alf globalstate -int {{ "1" if security.firewall else "0" }}
  when: (security.firewall is defined) and (firewall_status.stdout == 1 and security.firewall != True) or (firewall_status.stdout == 0 and security.firewall == True)
  become: True
  tags: preferences

- name: sleep settings (1/2)
  osx_defaults:
    domain: com.apple.screensaver
    key: askForPassword
    type: int
    value: 1
    state: present
  tags: preferences

- name: sleep settings (2/2)
  osx_defaults:
    domain: com.apple.screensaver
    key: askForPasswordDelay
    type: float
    value: 0
    state: present
  tags: preferences

- name: IME settings
  osx_defaults:
    domain: com.apple.inputmethod.Kotoeri
    key: JIMPrefLiveConversionKey
    type: bool
    value: false
    state: present
  tags: preferences

- name: languages settings
  osx_defaults:
    key: AppleLanguages
    type: array
    value: "{{ languages }}"
  tags: preferences

- name: locale settings
  osx_defaults:
    key: AppleLocale
    type: string
    value: "{{ locale }}"
  tags: preferences

- name: trackpad settings
  osx_defaults:
    key: com.apple.swipescrolldirection
    type: bool
    value: false
    state: present
  tags: preferences

- name: disable Siri
  osx_defaults:
    domain: com.apple.Siri
    key: StatusMenuVisible
    type: bool
    value: false
    state: present
  tags: preferences

- name: software update settings (1/2)
  shell: softwareupdate --schedule | awk -F'Automatic check is ' '{ print $2 }'
  register: autoupdate_status
  changed_when: False
  become: True
  tags: preferences

- name: software update settings (2/2)
  shell: softwareupdate --schedule "{{ "on" if autoupdate else "off" }}"
  when: (autoupdate is defined) and (autoupdate_status.stdout == "on" and autoupdate == False) or (autoupdate_status.stdout == "off" and autoupdate == True)
  become: True
  tags: preferences

- name: disable .DS_Store
  osx_defaults:
    domain: com.apple.desktopservices
    key: DSDontWriteNetworkStores
    type: bool
    value: "{{ no_dsstore }}"
    state: present
  tags: preferences
